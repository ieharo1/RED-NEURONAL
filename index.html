<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red Neuronal - Isaac Haro</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß†</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Space Grotesk',sans-serif;background:#0a0a0f;color:#e0e0e0;min-height:100vh}
        .wrap{max-width:1000px;margin:0 auto;padding:20px}
        h1{font-size:36px;font-weight:700;background:linear-gradient(135deg,#6366f1,#a855f7);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:5px}
        .sub{color:#6b7280;font-size:14px;margin-bottom:15px}
        .grid{display:grid;grid-template-columns:1fr 280px;gap:20px;margin-top:15px}
        @media(max-width:800px){.grid{grid-template-columns:1fr}}
        .card{background:#12121a;border:1px solid #1e1e2e;border-radius:12px;padding:15px;margin-bottom:15px}
        .ttl{font-family:'JetBrains Mono',monospace;font-size:11px;color:#6366f1;text-transform:uppercase;letter-spacing:2px;margin-bottom:10px}
        .box{background:#08080c;border-radius:8px;padding:8px;text-align:center}
        #cv{display:block;cursor:crosshair;background:#000;border-radius:6px;margin:0 auto}
        .btns{display:flex;gap:8px;margin-top:10px;justify-content:center}
        .btn{font-family:'JetBrains Mono',monospace;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.2s}
        .btnP{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff}
        .btnP:hover{transform:translateY(-1px);box-shadow:0 4px 15px rgba(99,102,241,0.3)}
        .btnR{background:linear-gradient(135deg,#ef4444,#f87171);color:#fff}
        .stat{background:#0a0a0f;border-radius:8px;padding:12px;text-align:center;margin:5px}
        .statV{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:700;color:#10b981}
        .statL{font-size:9px;color:#6b7280;text-transform:uppercase;margin-top:3px}
        .pred{text-align:center;padding:15px;background:#0a0a0f;border-radius:10px;margin-top:10px}
        .predD{font-family:'JetBrains Mono',monospace;font-size:48px;font-weight:700;background:linear-gradient(135deg,#6366f1,#a855f7);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .predL{font-size:11px;color:#6b7280;margin-top:5px}
        .probs{margin-top:10px}
        .prob{display:flex;align-items:center;gap:5px;margin:3px 0}
        .probN{font-family:'JetBrains Mono',monospace;font-size:11px;width:14px;color:#6b7280}
        .probB{flex:1;height:5px;background:#1e1e2e;border-radius:3px}
        .probF{height:100%;background:#6366f1;border-radius:3px}
        .probP{font-family:'JetBrains Mono',monospace;font-size:9px;width:35px;text-align:right;color:#888}
        .viz{height:150px;background:#050508;border-radius:8px}
        .log{background:#050508;border-radius:6px;padding:8px;height:80px;overflow-y:auto;font-family:'JetBrains Mono',monospace;font-size:9px;color:#6b7280}
        .logE{padding:2px 0;border-bottom:1px solid #0a0a0f}
        .logE.ok{color:#10b981}
        .feats{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap}
        .feat{background:#0a0a0f;border-radius:8px;padding:12px;flex:1;min-width:140px}
        .featI{font-size:18px;margin-bottom:5px}
        .featT{font-weight:600;font-size:12px}
        .featD{font-size:10px;color:#6b7280}
    </style>
</head>
<body>
    <div class="wrap">
        <h1>Red Neuronal</h1>
        <p class="sub">Reconocimiento de d√≠gitos escritos a mano (0-9)</p>
        
        <div class="feats">
            <div class="feat"><div class="featI">üß†</div><div class="featT">IA Propia</div><div class="featD">Implementaci√≥n</div></div>
            <div class="feat"><div class="featI">‚úèÔ∏è</div><div class="featT">Dibuja</div><div class="featD">N√∫meros 0-9</div></div>
            <div class="feat"><div class="featI">‚ö°</div><div class="featT">R√°pida</div><div class="featD">Predicci√≥n</div></div>
        </div>

        <div class="grid">
            <div class="col">
                <div class="card">
                    <div class="ttl">Dibuja un d√≠gito</div>
                    <div class="box"><canvas id="cv" width="224" height="224"></canvas></div>
                    <div class="btns">
                        <button class="btn btnR" id="clrBtn">Limpiar</button>
                        <button class="btn btnP" id="predBtn">Predecir</button>
                    </div>
                </div>
                <div class="card">
                    <div class="ttl">Resultado</div>
                    <div class="pred">
                        <div class="predD" id="res">?</div>
                        <div class="predL">D√≠gito reconocido</div>
                    </div>
                    <div class="probs" id="probs"></div>
                </div>
            </div>
            <div class="side">
                <div class="card">
                    <div class="ttl">Estado</div>
                    <div class="stat"><div class="statV" id="status">‚úì Lista</div><div class="statL">Red Neuronal</div></div>
                </div>
                <div class="card"><div class="ttl">Visualizaci√≥n</div><div class="viz" id="vizBox"><canvas id="viz"></canvas></div></div>
                <div class="card"><div class="ttl">Registro</div><div class="log" id="log"></div></div>
            </div>
        </div>
    </div>

    <script>
        // Red neuronal simple
        class NN {
            constructor(ls) {
                this.ls = ls;
                this.W = [];
                this.b = [];
            }
            init() {
                for (let i = 0; i < this.ls.length - 1; i++) {
                    const w = [], s = Math.sqrt(2 / this.ls[i]);
                    for (let j = 0; j < this.ls[i]; j++) {
                        w.push([]);
                        for (let k = 0; k < this.ls[i + 1]; k++) w[j].push((Math.random() - 0.5) * 2 * s);
                    }
                    this.W.push(w);
                    this.b.push(new Array(this.ls[i + 1]).fill(0));
                }
            }
            relu(x) { return Math.max(0, x); }
            soft(a) {
                const m = Math.max(...a), e = a.map(x => Math.exp(x - m)), s = e.reduce((x, y) => x + y, 0);
                return e.map(x => x / (s + 1e-10));
            }
            forward(x) {
                let a = x;
                for (let l = 0; l < this.W.length; l++) {
                    const n = [];
                    for (let j = 0; j < this.W[l][0].length; j++) {
                        let s = this.b[l][j];
                        for (let i = 0; i < a.length; i++) s += a[i] * this.W[l][i][j];
                        n.push(this.relu(s));
                    }
                    a = l === this.W.length - 1 ? this.soft(n) : n;
                }
                return a;
            }
            pred(x) { return this.forward(x); }
            train(xs, ys, ep) {
                if (!this.W.length) this.init();
                const lr = 0.2;
                for (let e = 0; e < ep; e++) {
                    for (let idx = 0; idx < xs.length; idx++) {
                        const out = this.forward(xs[idx]), trg = ys[idx];
                        let err = out.map((o, i) => o - trg[i]);
                        for (let l = this.W.length - 1; l >= 0; l--) {
                            const ne = new Array(this.ls[l]).fill(0);
                            for (let j = 0; j < this.W[l][0].length; j++) {
                                for (let i = 0; i < this.W[l].length; i++) {
                                    const g = err[j] * xs[idx][i];
                                    this.W[l][i][j] -= lr * g;
                                    ne[i] += err[j] * this.W[l][i][j];
                                }
                                this.b[l][j] -= lr * err[j];
                            }
                            if (l > 0) for (let i = 0; i < ne.length; i++) ne[i] *= this.forward(xs[idx])[i] > 0 ? 1 : 0;
                            err = ne;
                        }
                    }
                }
            }
        }

        const nn = new NN([784, 80, 40, 10]);

        // Generar datos de entrenamiento
        function genData() {
            const xs = [], ys = [];
            const draw = [
                (p, ox, oy) => { for (let a = 0; a < 6.3; a += 0.2) { const r = 6 + Math.random() * 2; const x = Math.round(14 + ox + Math.cos(a) * r), y = Math.round(14 + oy + Math.sin(a) * r); if (x > 1 && x < 26 && y > 1 && y < 26) p[y * 28 + x] = 1; } },
                (p, ox, oy) => { for (let y = 6; y < 22; y++) p[y * 28 + Math.round(14 + ox)] = 1; for (let x = 11; x < 18; x++) p[Math.round(11 + oy) * 28 + x] = 1; },
                (p, ox, oy) => { for (let x = 10; x < 19; x++) { p[(10 + oy) * 28 + x] = 1; p[(18 + oy) * 28 + x] = 1; } },
                (p, ox, oy) => { for (let x = 10; x < 19; x++) { p[(10 + oy) * 28 + x] = 1; p[(17 + oy) * 28 + x] = 1; } for (let x = 13; x < 19; x++) p[Math.round(13 + oy) * 28 + x] = 1; },
                (p, ox, oy) => { for (let y = 6; y < 22; y++) p[y * 28 + Math.round(15 + ox)] = 1; for (let x = 10; x < 18; x++) p[Math.round(14 + oy) * 28 + x] = 1; },
                (p, ox, oy) => { for (let x = 10; x < 19; x++) { p[(10 + oy) * 28 + x] = 1; p[(17 + oy) * 28 + x] = 1; } for (let y = 10; y < 14; y++) p[y * 28 + Math.round(10 + ox)] = 1; },
                (p, ox, oy) => { for (let y = 8; y < 20; y++) p[y * 28 + Math.round(11 + ox)] = 1; for (let x = 10; x < 18; x++) { p[(10 + oy) * 28 + x] = 1; p[(18 + oy) * 28 + x] = 1; } },
                (p, ox, oy) => { for (let x = 10; x < 18; x++) p[(10 + oy) * 28 + x] = 1; for (let y = 6; y < 22; y++) p[y * 28 + Math.round(17 + ox)] = 1; },
                (p, ox, oy) => { for (let a = 0; a < 6.3; a += 0.25) { const r1 = 4 + Math.random(), r2 = 7 + Math.random(); const x1 = Math.round(14 + ox + Math.cos(a) * r1), y1 = Math.round(11 + oy + Math.sin(a) * r1), x2 = Math.round(14 + ox + Math.cos(a) * r2), y2 = Math.round(17 + oy + Math.sin(a) * r2); if (x1 > 1 && x1 < 26 && y1 > 1 && y1 < 26) p[y1 * 28 + x1] = 1; if (x2 > 1 && x2 < 26 && y2 > 1 && y2 < 26) p[y2 * 28 + x2] = 1; } },
                (p, ox, oy) => { for (let y = 6; y < 18; y++) p[y * 28 + Math.round(15 + ox)] = 1; for (let x = 10; x < 18; x++) { p[(10 + oy) * 28 + x] = 1; p[(18 + oy) * 28 + x] = 1; } }
            ];
            
            for (let d = 0; d < 10; d++) {
                for (let v = 0; v < 30; v++) {
                    const p = new Array(784).fill(0);
                    draw[d](p, (Math.random() - 0.5) * 3, (Math.random() - 0.5) * 3);
                    xs.push(p);
                    const y = new Array(10).fill(0);
                    y[d] = 1;
                    ys.push(y);
                }
            }
            return { xs, ys };
        }

        // Canvas
        const cv = document.getElementById('cv');
        const ctx = cv.getContext('2d');
        const viz = document.getElementById('viz');
        const vizCtx = viz.getContext('2d');
        let draw = false, lx = 0, ly = 0;

        function init() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, cv.width, cv.height);
            viz.width = viz.offsetWidth;
            viz.height = viz.offsetHeight;

            cv.onmousedown = e => { const r = cv.getBoundingClientRect(); draw = true; lx = (e.clientX - r.left) * (cv.width / r.width); ly = (e.clientY - r.top) * (cv.height / r.height); };
            cv.onmousemove = e => { if (!draw) return; const r = cv.getBoundingClientRect(); const x = (e.clientX - r.left) * (cv.width / r.width), y = (e.clientY - r.top) * (cv.height / r.height); ctx.strokeStyle = '#fff'; ctx.lineWidth = 14; ctx.lineCap = 'round'; ctx.beginPath(); ctx.moveTo(lx, ly); ctx.lineTo(x, y); ctx.stroke(); lx = x; ly = y; };
            cv.onmouseup = () => draw = false;
            cv.onmouseleave = () => draw = false;

            document.getElementById('clrBtn').onclick = clear;
            document.getElementById('predBtn').onclick = predict;

            log('Generando datos...');
            const { xs, ys } = genData();
            log('Entrenando red...');
            
            setTimeout(() => {
                nn.train(xs, ys, 5);
                log('¬°Lista!');
                drawViz();
            }, 100);
        }

        function clear() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, cv.width, cv.height);
            document.getElementById('res').textContent = '?';
            document.getElementById('probs').innerHTML = '';
        }

        function getData() {
            const t = document.createElement('canvas');
            t.width = t.height = 28;
            const tc = t.getContext('2d');
            tc.fillStyle = '#000';
            tc.fillRect(0, 0, 28, 28);
            tc.drawImage(cv, 0, 0, 28, 28);
            const d = tc.getImageData(0, 0, 28, 28).data;
            return Array.from({ length: 784 }, (_, i) => d[i * 4] / 255);
        }

        function predict() {
            const inp = getData();
            const out = nn.pred(inp);
            const p = out.indexOf(Math.max(...out));
            const c = (Math.max(...out) * 100).toFixed(0);
            
            document.getElementById('res').textContent = p;
            
            let h = '';
            out.forEach((v, i) => {
                const pct = (v * 100).toFixed(0);
                h += `<div class="prob"><span class="probN">${i}</span><div class="probB"><div class="probF" style="width:${pct}%;${i===p?'background:#10b981':''}"></div></div><span class="probP">${pct}%</span></div>`;
            });
            document.getElementById('probs').innerHTML = h;
            log(`Pred: ${p} (${c}%)`);
        }

        function drawViz() {
            vizCtx.fillStyle = '#050508';
            vizCtx.fillRect(0, 0, viz.width, viz.height);
            const ls = [5, 4, 4, 10], xs = [30, 100, 170, 240];
            for (let l = 0; l < ls.length; l++) {
                const sp = (viz.height - 20) / ls[l];
                for (let i = 0; i < ls[l]; i++) {
                    const y = 10 + i * sp + sp / 2;
                    vizCtx.beginPath();
                    vizCtx.arc(xs[l], y, 5, 0, Math.PI * 2);
                    vizCtx.fillStyle = l === 3 ? '#10b981' : '#6366f1';
                    vizCtx.fill();
                    if (l > 0) {
                        const psp = (viz.height - 20) / ls[l - 1];
                        for (let j = 0; j < ls[l - 1]; j++) {
                            vizCtx.beginPath();
                            vizCtx.moveTo(xs[l] - 7, y);
                            vizCtx.lineTo(xs[l] - 14, 10 + j * psp + psp / 2);
                            vizCtx.strokeStyle = 'rgba(99,102,241,0.1)';
                            vizCtx.stroke();
                        }
                    }
                }
            }
        }

        function log(msg) {
            const l = document.getElementById('log');
            const e = document.createElement('div');
            e.className = 'logE ok';
            e.textContent = msg;
            l.insertBefore(e, l.firstChild);
        }

        window.onload = init;
    </script>
</body>
</html>
